on:
  workflow_dispatch:
jobs:
  demo_app_authentication:
    runs-on: ubuntu-latest
    env: 
      ORG_NAME: PixelBayStudios
    steps:
      - name: Generate a token
        id: generate-token
        uses: actions/create-github-app-token@v1
        with:
            app-id: ${{ vars.APP_ID }}
            private-key: ${{ secrets.APP_PRIVATE_KEY }}

      - name: List all personal access tokens for the Space Telescope Science Institute
        # Only GitHub Apps can use this endpoint
        uses: octokit/request-action@v2.x
        with:
          route: GET /orgs/${{github.env.ORG_NAME}}/personal-access-tokens
        env:
          GITHUB_TOKEN: ${{ steps.generate-token.outputs.token }}
          

      - name: Make a personal access token request
        # Only GitHub Apps can use this endpoint
        uses: octokit/request-action@v2.x
        with:
          route: GET /orgs/${{github.env.ORG_NAME}}/personal-access-tokens
        env:
          GITHUB_TOKEN: ${{ steps.generate-token.outputs.token }}

      - name: Review the personal access token request
        # Only GitHub Apps can use this endpoint
        uses: octokit/request-action@v2.x
        with:
          route: GET /orgs/${{github.env.ORG_NAME}}/personal-access-token-requests/{pat_request_id}
        env:
          GITHUB_TOKEN: ${{ steps.generate-token.outputs.token }}

          #'{"action":"deny","reason":"This request is denied because the access is too broad."}'

          

      - name: List all personal access tokens for the Space Telescope Science Institute
        # Only GitHub Apps can use this endpoint
        uses: octokit/request-action@v2.x
        with:
          route: GET /orgs/${{github.env.ORG_NAME}}/personal-access-tokens/{pat_id}/repositories
        env:
          GITHUB_TOKEN: ${{ steps.generate-token.outputs.token }}

